<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009"
                xmlns:s="library://ns.adobe.com/flex/spark"
                autoDrawBackground="true"
                width="100%" height="50" doubleClick="onDoubleClick(event)" doubleClickEnabled="true">
    <fx:Script>
		<![CDATA[
        import com.andrewgura.events.DataObjectEvent;
        import com.andrewgura.vo.TextureVO;

        import mx.events.FlexEvent;

        [Bindable]
        public var isInEditMode:Boolean = false;

        private function onDoubleClick(event:MouseEvent):void {
            isInEditMode = true;
            editNameTextInput.addEventListener(FocusEvent.FOCUS_OUT, onEditNameFocusOut);
            editNameTextInput.setFocus();
        }

        private function onEditNameFocusOut(event:FocusEvent):void {
            isInEditMode = false;
        }

        private function onEditImageEnter(event:FlexEvent):void {
            if (!isInEditMode) {
                return;
            }
            dispatchEvent(new DataObjectEvent("renameTexture", {texture:data, newName: editNameTextInput.text}, true));
            isInEditMode = false;
            this.setFocus();
        }
        ]]>
	</fx:Script>

    <s:Rect right="0" width="{(100-TextureVO(data).processingProgress)*width/100}" height="100%"
            visible="{!TextureVO(data).atfData || !TextureVO(data).name}">
        <s:fill>
            <s:SolidColor color="#ff0000"/>
        </s:fill>
    </s:Rect>

    <s:HGroup width="100%" height="100%" paddingLeft="5" paddingRight="5" gap="5" verticalAlign="middle">
        <s:BitmapImage source="{TextureVO(data).sourceBitmap}" width="40" height="40"/>
        <s:Label text="{TextureVO(data).name}" visible="{!isInEditMode}" includeInLayout="{!isInEditMode}"/>
        <s:TextInput id="editNameTextInput" text="{TextureVO(data).name}"
                     visible="{isInEditMode}" includeInLayout="{isInEditMode}"
                     enter="onEditImageEnter(event)"/>
        <s:Spacer width="100%"/>
        <s:Label text="{TextureVO(data).originalWidth}X{TextureVO(data).originalHeight} --> {TextureVO(data).atfWidth}X{TextureVO(data).atfHeight}"/>
    </s:HGroup>

</s:ItemRenderer>
